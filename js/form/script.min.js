"use strict";(()=>{class t{element;action="";disabled=!1;errorContainer;successContainer;captchaLoaded=null;captchaKey=null;constructor({element:e}){this.element=e,this.element.removeEventListener("submit",this.#handleSubmit),this.element.addEventListener("submit",this.#handleSubmit),this.errorContainer=document.createElement("div"),this.element.prepend(this.errorContainer),this.successContainer=document.createElement("div"),this.element.prepend(this.successContainer),this.captchaKey=this.element.getAttribute("data-captcha"),this.action=this.element.getAttribute("action")||"",this.captchaKey&&(this.disabled=!0,this.captchaLoaded=this.#getDefferedPromise(),window.grecaptcha?window.grecaptcha.ready(()=>{this.disabled=!1,this.captchaLoaded?.resolve()}):(e=()=>{var e;document.querySelector('script[src*="recaptcha"]')?(this.disabled=!1,this.captchaLoaded?.resolve()):((e=document.createElement("script")).src="https://www.google.com/recaptcha/api.js?render="+this.captchaKey,document.body.appendChild(e),e.onload=()=>{window.grecaptcha.ready(()=>{this.disabled=!1,this.captchaLoaded?.resolve()})})},window.addEventListener("scroll",e,{once:!0,passive:!0}),window.addEventListener("touchstart",e,{once:!0}),document.addEventListener("mouseenter",e,{once:!0}),document.addEventListener("click",e,{once:!0})))}#getDefferedPromise=()=>{let n,e;return(e=new Promise((e,t)=>{n=e})).resolve=n,e};#isStringHTML=e=>{return[...(new DOMParser).parseFromString(e,"text/html").body.childNodes].some(e=>1===e.nodeType)};#renderString=({string:e,container:t,config:n})=>{var n=n.replace,r=document.createElement("template"),e=(r.innerHTML=e,r.content);return e.querySelectorAll("script").forEach(e=>{var t=e.parentNode,n=(t?.removeChild(e),document.createElement("script"));n.text=e.text,t?.append(n)}),n?t.replaceChildren(e):t.appendChild(e)};#handleSubmit=async t=>{if(t.preventDefault(),this.action.trim().length&&!this.disabled){this.disabled=!0;var t=new FormData(this.element),n=(this.captchaKey&&(n=await window.grecaptcha.execute(this.captchaKey,{action:"submit"}),t.set("g-recaptcha-response",n)),[...this.element.elements].find(e=>(e instanceof HTMLButtonElement||e instanceof HTMLInputElement)&&"submit"===e.type));let e="";n&&(e=n.innerHTML,n.innerHTML='<svg style="margin:auto;" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 38 38" stroke="currentColor"><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".5" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g></svg>');try{var r=await fetch(this.action,{method:"POST",body:t});if(r.ok){var i=await r.json();if("error"===i.status){var a=i.errors[0];if("FIELD_VALIDATION_ERROR"===a.code){const s=this.element.elements[a.customData];s&&(s.setCustomValidity(a.message),s.reportValidity(),s.addEventListener("input",()=>{s.setCustomValidity(""),s.reportValidity(),s.checkValidity()},{once:!0}))}"FORM_GENERAL_ERROR"===a.code&&this.#isStringHTML(a.message)&&this.#renderString({string:a.message,container:this.errorContainer,config:{replace:!0}}),this.disabled=!1,console.error(a)}else"success"===i.status&&(this.#isStringHTML(i.data)&&this.#renderString({string:i.data,container:this.successContainer,config:{replace:!0}}),this.element.reset(),this.disabled=!1)}else this.disabled=!1,console.error(r)}catch(e){console.error(e)}finally{n&&(n.innerHTML=e),this.disabled=!1}}}}null==window.welpodron&&(window.welpodron={}),window.welpodron.form=t,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("form[data-form]").forEach(e=>{new t({element:e})})},{once:!0})})();